<!doctype html>
<html lang="en">
  <head>
    <%= partial 'layouts/_html_head', locals: {
      title: "macapinlac.com - #{current_article.title}",
      description: current_article.data.summary || 'Personal blog and portfolio of Ritchie Macapinlac - thoughts on technology, life, and everything in between'
    } %>
  </head>
  <body>
    <div class="site-container">
      <%= partial 'layouts/_header' %>

      <main class="main-content">
        <article class="post">
          <header class="post-header">
            <div class="post-meta">
              <time datetime="<%= current_article.date.iso8601 %>" class="post-date">
                <%= current_article.date.strftime('%B %d, %Y') %>
              </time>
              <% unless current_article.tags.empty? %>
                <span class="post-tags">
                  <% current_article.tags.each do |tag| %>
                    <%= link_to "##{tag}", tag_path(tag), class: 'post-tag' %>
                  <% end %>
                </span>
              <% end %>
            </div>
            
            <h1 class="post-title"><%= current_article.title %></h1>
            
            <% if current_article.data.summary %>
              <p class="post-summary"><%= current_article.data.summary %></p>
            <% end %>
          </header>

          <div class="post-content">
            <% if current_article.data.reply %>
              <div class="post-reply">
                <p class="post-reply-label">In reply to:</p>
                <%= link_to current_article.data.reply.reply_title || current_article.data.reply.url, 
                            current_article.data.reply.url, 
                            class: 'post-reply-link' %>
              </div>
            <% end %>

            <%= yield %>
          </div>

          <footer class="post-footer">
            <% if current_article.data.series %>
              <div class="post-series">
                <h3>Part of the "<%= current_article.data.series %>" series</h3>
                <!-- Add series navigation here if needed -->
              </div>
            <% end %>

            <div class="post-navigation">
              <% if current_article.article_previous %>
                <%= link_to "← #{current_article.article_previous.title}", 
                            current_article.article_previous, 
                            class: 'post-nav-link post-nav-prev' %>
              <% end %>
              
              <% if current_article.article_next %>
                <%= link_to "#{current_article.article_next.title} →", 
                            current_article.article_next, 
                            class: 'post-nav-link post-nav-next' %>
              <% end %>
            </div>

            <% if current_article.data.changelog %>
              <details class="post-changelog">
                <summary>Changelog</summary>
                <ul>
                  <% current_article.data.changelog.each do |change| %>
                    <li>
                      <time datetime="<%= change.date %>"><%= change.date %></time>
                      <span><%= change.message %></span>
                    </li>
                  <% end %>
                </ul>
              </details>
            <% end %>
          </footer>
        </article>
      </main>

      <%= partial 'layouts/_footer' %>
    </div>

    <!-- Dark mode toggle script -->
    <script>
      function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      }
    </script>
  </body>
</html>
