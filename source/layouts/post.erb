<!doctype html>
<html lang="en">
  <head>
    <%= partial 'layouts/_html_head', locals: {
      title: "macapinlac.com - #{current_article.title}",
      description: current_article.data.summary || 'Personal blog and portfolio of Ritchie Macapinlac - thoughts on technology, life, and everything in between'
    } %>
  </head>
  <body>
    <div class="site-container">
      <%= partial 'layouts/_header' %>

      <main class="main-content">
        <article class="post">
          <header class="post-header">
            <div class="post-meta">
              <time datetime="<%= current_article.date.iso8601 %>" class="post-date">
                <%= current_article.date.strftime('%B %d, %Y') %>
              </time>
              <% unless current_article.tags.empty? %>
                <span class="post-tags">
                  <% current_article.tags.each do |tag| %>
                    <%= link_to "##{tag}", tag_path(tag), class: 'post-tag' %>
                  <% end %>
                </span>
              <% end %>
            </div>
            
            <h1 class="post-title"><%= current_article.title %></h1>
            
            <% if current_article.data.summary %>
              <p class="post-summary"><%= current_article.data.summary %></p>
            <% end %>
          </header>

          <div class="post-content">
            <% if current_article.data.reply %>
              <div class="post-reply">
                <p class="post-reply-label">In reply to:</p>
                <%= link_to current_article.data.reply.reply_title || current_article.data.reply.url, 
                            current_article.data.reply.url, 
                            class: 'post-reply-link' %>
              </div>
            <% end %>

            <%= yield %>
          </div>

          <footer class="post-footer">
            <% if current_article.data.series %>
              <% series_nav = series_navigation(current_article) %>
              <div class="post-series">
                <h3>Part of the "<%= series_nav[:series_name] %>" series</h3>
                <div class="series-progress">
                  <span class="series-progress-text">
                    Part <%= series_nav[:current_index] + 1 %> of <%= series_nav[:total_posts] %>
                  </span>
                  <div class="series-progress-bar">
                    <div class="series-progress-fill" style="width: <%= ((series_nav[:current_index] + 1).to_f / series_nav[:total_posts]) * 100 %>%"></div>
                  </div>
                </div>
                
                <div class="series-navigation">
                  <% if series_nav[:previous_post] %>
                    <%= link_to "← Previous: #{series_nav[:previous_post].title}", 
                                series_nav[:previous_post], 
                                class: 'series-nav-link series-nav-prev' %>
                  <% end %>
                  
                  <%= link_to "View All Posts in Series", 
                              "/series/#{series_nav[:series_name].downcase.gsub(/\s+/, '-')}.html", 
                              class: 'series-nav-link series-nav-all' %>
                  
                  <% if series_nav[:next_post] %>
                    <%= link_to "Next: #{series_nav[:next_post].title} →", 
                                series_nav[:next_post], 
                                class: 'series-nav-link series-nav-next' %>
                  <% end %>
                </div>
              </div>
            <% end %>

            <div class="post-navigation">
              <% if current_article.article_previous %>
                <%= link_to "← #{current_article.article_previous.title}", 
                            current_article.article_previous, 
                            class: 'post-nav-link post-nav-prev' %>
              <% end %>
              
              <% if current_article.article_next %>
                <%= link_to "#{current_article.article_next.title} →", 
                            current_article.article_next, 
                            class: 'post-nav-link post-nav-next' %>
              <% end %>
            </div>

            <% if current_article.data.changelog %>
              <details class="post-changelog">
                <summary>Changelog</summary>
                <ul>
                  <% current_article.data.changelog.each do |change| %>
                    <li>
                      <time datetime="<%= change.date %>"><%= change.date %></time>
                      <span><%= change.message %></span>
                    </li>
                  <% end %>
                </ul>
              </details>
            <% end %>
          </footer>
        </article>
      </main>

      <%= partial 'layouts/_footer' %>
    </div>

    <!-- Dark mode toggle script -->
    <script>
      function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      }
    </script>
  </body>
</html>
